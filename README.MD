# automatic-i18n

[![CI](./assets/badge.svg)](https://github.com/zcs19871221/automatic-i18n/actions/workflows/npm-publish.yml)
[![Test coverage](https://img.shields.io/coverallsCoverage/github/zcs19871221/automatic-i18n)](https://coveralls.io/github/zcs19871221/automatic-i18n)
[![npm version](https://img.shields.io/npm/v/automatic-i18n?style=flat-square)](https://www.npmjs.com/package/automatic-i18n)

## Introduction

automatic-i18n is an internationalization tool that automatically replaces language text in the source code(typescript、js、react) with one command and without writing additional code and generates multi-language files. I use the typescript compiler and integrate the react-intl library to achieve this.

I hope that websites in different languages ​​can benefit more people in the world, hope world peace.

features:

- Write your code as if it were not an international project. Then run a one-line command which will replace all locale text with i18n keys and generate some message files according to your configuration. No need to write extra code.
- The languages ​​to be replaced and the languages ​​to be generated can be configured.
- Automatically merge template strings and jsx html text with variables.
- Integrated with `react-intl` library. (you could write your own custom render class by implement `I18nFormatter` and pass your class as params. The default class is enough)
- Supports hook mode (changing language in real time) and global mode, and can use custom render classes to determine how to replace source code and generate language files.
- Test coverage 98%.

## Example

Your code Before:

    import React from 'react';

    function Component() {
        const en = 'English';
        const cn = 'Chinese';
        const locales = `${en} and ${cn}`;

        return (
            <div>
                Please choose your locale from: {en} {cn}
            </div>
        );
    }

Your code will be replaced with the below after run command:

    import { useIntl, FormattedMessage } from 'react-intl';
    import React from 'react';

    function Component() {
        const intl = useIntl();

        const en = intl.formatMessage({
            id: 'key0001',
            defaultMessage: 'English',
        });
        const cn = intl.formatMessage({
            id: 'key0002',
            defaultMessage: 'Chinese',
        });
        const locales = intl.formatMessage({
            id: 'key0003',
            defaultMessage: '{v1} and {v2}',
            values: { v1: en, v2: cn },
        });

        return (
            <div>
                <FormattedMessage
                    id="key0004"
                    defaultMessage="Please choose your locale from: {v1} {v2}"
                    values={{ v1: en, v2: cn }}
                />
            </div>
        );
    }

Some locale message files will be generated automatic.

    /*
    * This file is automatic generated by automatic-i18n.
    * You can only change variable's value.
    */
    import { LocalKey } from './types';

    const locale: Record<LocalKey, string> = {
        key0001: 'English',
        key0002: 'Chinese',
        key0003: '{v1} and {v2}',
        key0004: 'Please choose your locale from: {v1} {v2}',
    };

    export default locale;

And the entry template file will be generated which will use above locale message files. This template export a provider and a global object and you could use them in your own prefer. You could see the example file here:

# Quick start

## cli

`npx automatic-i18n`
you can get specific info with `npx automatic-i18n -h`

## api

The input parameter defined with `ReplacerOpt` below, only one parameter **I18nFormatter** is not exist in cli options.

    const I18nReplacer = require('automatic-i18n').default;

    I18nReplacer.createI18nReplacer({
        targets: ['components', 'hooks', 'middleware', 'modules', 'pages', 'utils'],
        uniqIntlKey: true,
    }).replace();

    export interface ReplacerOpt {
        targets?: string[];
        distLocaleDir?: string;
        localeToReplace?: LocaleTypes;
        localesToGenerate?: LocaleTypes[];
        global?: boolean;
        meaningKey?: boolean;
        uniqIntlKey?: boolean;
        I18nFormatter?: I18nFormatterCtr;
        filters?: Filter[];
        // baseNames
        excludes?: string[];
        debug?: boolean;
        outputToNewDir?: string;
    }

## TODO

1. add block ignore syntax :

   /** @auto-i18n-ignore-next ** /
   /** @auto-i18n-ignore ** /
   /** @auto-i18n-ignore-start **/
   /** @auto-i18n-ignore-end **/

2. support for vue

3. A new syntax to mark a section of code, with the option to translate only the code covered by this syntax, to help developers whose native language is English (it is difficult to tell whether an English variable is a text to be translated or a value)

## License

The MIT License.
